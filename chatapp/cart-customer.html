<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>My cart</title>
    <link rel="shortcut icon" type="image/x-icon" href="./../assets/images/favicon.ico" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap"></noscript>
    <link rel="stylesheet" href="../assets/css/style.min.css">
</head>
<body>
    <main class="wrapper">
        <div class="container container--fixed container--popup">
            <div class="cart__notify cart-notify-js stop-body-js">
                <svg class="cart__notify__icon" xmlns="http://www.w3.org/2000/svg" width="38" height="38" viewBox="0 0 38 38"><defs><style>.a44{fill:#013253;}.b44{fill:none;}</style></defs><path class="a44" d="M10.463,27.235a3.154,3.154,0,1,0,3.154,3.154A3.15,3.15,0,0,0,10.463,27.235ZM1,2V5.154H4.154L9.832,17.125,7.7,20.989A3.049,3.049,0,0,0,7.309,22.5a3.164,3.164,0,0,0,3.154,3.154H29.389V22.5H11.125a.39.39,0,0,1-.394-.394l.047-.189L12.2,19.349h11.75a3.139,3.139,0,0,0,2.76-1.624L32.354,7.489a1.541,1.541,0,0,0,.189-.757,1.582,1.582,0,0,0-1.577-1.577H7.64L6.157,2H1ZM26.235,27.235a3.154,3.154,0,1,0,3.154,3.154A3.15,3.15,0,0,0,26.235,27.235Z" transform="translate(0.614 1.228)"></path><path class="b44" d="M0,0H38V38H0Z"></path></svg>
                <p class="cart__notify__content">
                    <span class="cart__notify__title"></span>
                    <a class="cart__notify__view" href="#">View cart</a>
                </p>
                <svg class="cart__notify__close notify-close-js" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><defs><style>.a11{fill:#fff;stroke:#000;opacity:0;}.b11{fill:none;stroke:#013253;stroke-linecap:round;stroke-width:2px;}</style></defs><g transform="translate(-3835 23564.5)"><rect class="a11" width="24" height="24" transform="translate(3859.5 -23540) rotate(180)"></rect><line class="b11" x2="11" transform="translate(3843.5 -23555.5) rotate(45)"></line><line class="b11" x2="11" transform="translate(3843.5 -23547.723) rotate(-45)"></line></g></svg>
            </div>
            <h1 class="cart__title cart__title--chatapp">My Cart</h1>
            <section class="cart">
                <div class="cart__info bg-cart cart__info--chatapp">
                    <div class="cart__search-box">
                        <div class="cart__search cart-search-js">
                            <form action="" method="GET" class="frm frm__search">
                                <input id="search-product" class="form__control--search" type="text" name="search" autocomplete="off" placeholder="Search DrBerg for health products" />
                                <div class="input__group d-flex">
                                    <button type="button" class="btn--search">
                                        <img src="./../assets/images/icon_search.svg" alt="search">
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <p class="cart__discount cart__discount--chatapp">DrBerg original products. 30 Days money back guarantee. 100% Secure checkout.</p>
                    <div class="cart__items cart__items--chatapp show-cart-js"></div>
                    <div class="cart__total">
                        <div class="col__auto col__12 col__xl__5 ml-auto">
                            <p class="cart__total__item mb-1 order__info--flex">
                                <label class="info__label cart__desktop">Products:</label>
                                <label class="info__label cart__mobile">Products cost:</label>
                                <span>$<span id="product-cost-js" class="product-cost-js"></span></span>
                            </p>
                            <p class="cart__total__item cart__desktop mb-1 order__info--flex">
                                <label class="info__label">Shipping:</label>
                                <span>
                                    (Estimated $11.63) 
                                    <span class="tooltip">
                                        <svg class="icon-hint" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><defs><style>.a55{fill:#fff;stroke:#013253;}.b55{fill:#013253;font-size:12px;font-family:Roboto-Regular, Roboto;}.c55{stroke:none;}.d{fill:none;}</style></defs><g transform="translate(-201 -707)"><g class="a55" transform="translate(201 707)"><circle class="c55" cx="9" cy="9" r="9"></circle><circle class="d55" cx="9" cy="9" r="8.5"></circle></g><text class="b55" transform="translate(207 720)"><tspan x="0" y="0">?</tspan></text></g></svg>
                                        <span class="tooltip__price tooltip__price--shipping stop-body-js">
                                            Shipping cost is calculated in real time based on your location during checkout. <br/>
                                            For US it starts from $11.63 (Ground 1-4 Days) and $18.41 for 2 Day Air
                                            <svg class="tooltip__close" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><defs><style>.a44{fill:#fff;stroke:#000;opacity:0;}.b44{fill:none;stroke:#707070;stroke-linecap:round;stroke-width:2px;}</style></defs><g transform="translate(-3835 23564.5)"><rect class="a44" width="24" height="24" transform="translate(3859.5 -23540) rotate(180)"></rect><line class="b44" x2="11" transform="translate(3843.5 -23555.5) rotate(45)"></line><line class="b44" x2="11" transform="translate(3843.5 -23547.723) rotate(-45)"></line></g></svg>
                                        </span>
                                    </span>
                                </span>
                            </p>
                            <p class="cart__total__item mb-1 order__info--flex">
                                <label class="info__label">Subtotal:</label>
                                <span class="total-js">
                                    $<span id="subtotal-cart-js" class="subtotal-cart-js"></span>
                                    <span class="tooltip">
                                        <svg class="icon-hint" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><defs><style>.a55{fill:#fff;stroke:#013253;}.b55{fill:#013253;font-size:12px;font-family:Roboto-Regular, Roboto;}.c55{stroke:none;}.d{fill:none;}</style></defs><g transform="translate(-201 -707)"><g class="a55" transform="translate(201 707)"><circle class="c55" cx="9" cy="9" r="9"></circle><circle class="d55" cx="9" cy="9" r="8.5"></circle></g><text class="b55" transform="translate(207 720)"><tspan x="0" y="0">?</tspan></text></g></svg>
                                        <span class="tooltip__price stop-body-js">
                                            Price including taxes (estimated shipping cost is not included)
                                            <svg class="tooltip__close" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><defs><style>.a44{fill:#fff;stroke:#000;opacity:0;}.b44{fill:none;stroke:#707070;stroke-linecap:round;stroke-width:2px;}</style></defs><g transform="translate(-3835 23564.5)"><rect class="a44" width="24" height="24" transform="translate(3859.5 -23540) rotate(180)"></rect><line class="b44" x2="11" transform="translate(3843.5 -23555.5) rotate(45)"></line><line class="b44" x2="11" transform="translate(3843.5 -23547.723) rotate(-45)"></line></g></svg>
                                        </span>
                                    </span>
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-sm-btn mt-30 mb-4 ml-auto mr-auto">
                        <button class="btn btn--checkout btn--checkout--chatapp chatapp-confirm-js">Confirm Cart</button>
                    </div>
                </div>                                
            </section>
        </div>
    </main>
    <script>
        // Close notify cart
        document.querySelector('.notify-close-js').addEventListener('click', function(){    
            this.parentElement.classList.remove('cart__notify--active');
        });
        //Close tooltip
        let openTooltip = document.querySelectorAll('.icon-hint');
        for(let i = 0; i < openTooltip.length; i++){
            openTooltip[i].addEventListener('click', function(e){
                e.stopPropagation();
                let closeTooltip = document.querySelectorAll('.tooltip__price');
                for(let i = 0; i < closeTooltip.length; i++){
                    closeTooltip[i].style.display = 'none';
                }
                this.nextElementSibling.style.display = 'block';
            });
        }
        let closeTooltip = document.querySelectorAll('.tooltip__close');
        for(let i = 0; i < closeTooltip.length; i++){
            closeTooltip[i].addEventListener('click', function(){
                this.parentElement.style.display = 'none';
            });
        }
    </script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/cart.js"></script>
    <script src="../assets/js/cart-chatapp.js"></script>
    <script>
        /*Confirm cart*/
        if(document.querySelector('.chatapp-confirm-js')) closeCart();
        function closeCart(){
            document.querySelector('.chatapp-confirm-js').addEventListener('click', function(){
                if (window.opener != null && !window.opener.closed) {
                    viewCartCustomer();
                    let htmlBody = window.opener.document.querySelector('.shop-cart').innerHTML;
                    let content = '<div class="chatapp__order__head confirm-cart">'
                                        + '<h4 class="order__heading order__heading--confirm">Confirmed Cart</h4>'
                                    + '</div>'
                                    + htmlBody;  
                    window.opener.receivedPopup(content);
                }
                window.close();
            });
        };    
        //Cart Sales
        function viewCartCustomer(){
            let cartArray = shoppingCart.listCart();
            let viewCartChatApp = '';
            for(let i in cartArray) {
                let priceDiscount = cartArray[i].product.price_discount !== undefined ? '<span class="order__price__discount">$'+cartArray[i].product.price_discount+'</span>' : '';
                viewCartChatApp += "<div class='row'>"
                            + "<div class='col__4 col__sm__3 text-center pr-0'>"
                                + "<img src='"+cartArray[i].product.image+"' alt='"+ cartArray[i].product.name +"' width='100%'>"
                            + "</div>"
                            + "<div class='col__8 col__sm__9'>" 
                                + "<p class='products__quantity'>x"+cartArray[i].count+"</p>"                       
                                + "<a href='#' class='products__title'>"+ cartArray[i].product.name +"</a>"
                                + "<p class='order__price'>"
                                    + '<span class="order__price__special">$'+cartArray[i].product.price+'</span>'
                                    + priceDiscount
                                +"</p>"
                            + "</div>"
                        +  "</div>";
            }
            window.opener.document.getElementById('chatapp-product').innerHTML = viewCartChatApp;
            window.opener.document.querySelector('.chatapp-subtotal-js').innerHTML = '<label class="info__label">Total: '+shoppingCart.totalCount()+' <span>product</span></label>'
                                                                    + '<label class="info__price">$'+shoppingCart.subTotalCart()+'</label>';
        } 
    </script>
</body>
</html>